---
title: "Steam Sales Project"
output: html_notebook
author: Andrew Dai
date: 11.10.20
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(pwr)
library(MASS)
library(pscl)
library(vcd)
library(boot)
library(VGAM)
library(AER)
library(rstanarm)
```

```{r}

steam <- read.csv("steam.csv")

cat("Steam dataset has",as.character(nrow(steam)),"rows and",as.character(ncol(steam)),"columns:","\n")
cat(names(steam), sep=", ")

# Data Cleaning

# lower bound of owners range taken for each value
steam$owners <- as.integer(gsub("([0-9]+).*$", "\\1", steam$owners))
steam$release_year <- as.integer(gsub("([0-9]+).*$", "\\1", steam$release_date))
steam$total_ratings <- steam$positive_ratings+steam$negative_ratings

# steam$genres <- strsplit(steam$genres, ";")
# sum(table(grep("Action",steam$genres)))

plot(steam$price,jitter(log(steam$owners),2),xlim=c(0,80), main="Effect of price on owners")
plot(jitter(steam$release_year,2),jitter(log(steam$owners),2), main="Effect of release year on owners")
plot(log(steam$total_ratings),jitter(log(steam$owners),2), main="Effect of total ratings on owners", ylab="log(owners)", xlab="")


```

```{r}
# EDA
# Question: What makes a game popular on Steam?
# Definition of popular: many regular players

# Hypothesis / Variable Selection
# Price could be a variable that makes a game popular because if price is lower or free, it allows more people to afford the game.
# Positive ratings could be a variable that makes a game popular because it advertises the game to new players.
# Modern games should have a greater ownership than games created when Steam was first launched. However, games that have
# been just released may see a lag time before they are able to reach stable levels of ownership.

# log(owners) ~ beta0 + beta1(price) + beta2(positive_ratings/(positive_ratings+negative_ratings)) + beta3(release_year)

#

steam <- data.frame(owners=steam$owners, price=steam$price, ratings=steam$positive_ratings/(steam$positive_ratings+steam$negative_ratings), release_year=steam$release_year)
```

```{r}

# multilevel model or causal inference

# poisson regression
model <- glm(owners~price+ratings+release_year,family="poisson"(link="log"),data=steam)
model.nb <- glm.nb(owners~price+ratings+release_year,data=steam)
model.zi <- zeroinfl(owners~price+ratings+release_year,data=steam)

```

```{r}
plot(predict(model),resid(model), main="Poisson Predicted vs Resids")

# the residuals appear to be underdispersed 

vcd::rootogram(steam$owners, predict(model), scale = "raw")

plot(predict(model.nb),resid(model.nb), main="Poisson Predicted vs Resids")

# still out of 2 sd band
vcd::rootogram(steam$owners, predict(model.nb), scale = "raw")

plot(predict(model.zi),resid(model.zi), main="Poisson Predicted vs Resids")

# The zero-inflated model seems to fit our data better.

vcd::rootogram(steam$owners, predict(model.zi), scale = "raw")

```


